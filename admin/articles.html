<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý Bài viết</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/admin.css">
    <link rel="stylesheet" href="../css/responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="admin-layout">
        <aside class="admin-sidebar">
            <div class="admin-logo">
                <img src="../image/logo.png" alt="HA Farm Academy" class="admin-logo-img">
                <span>HA Farm Academy</span>
            </div>
            <div class="admin-subtitle">Admin Panel</div>
            <nav class="admin-nav">
                <a href="dashboard.html"><i class="fas fa-chart-line"></i> Dashboard</a>
                <a href="articles.html" class="active"><i class="fas fa-newspaper"></i> Bài viết</a>
                <a href="users.html"><i class="fas fa-users"></i> Người dùng</a>
                <a href="comments.html"><i class="fas fa-comments"></i> Bình luận</a>
                <a href="questions.html"><i class="fas fa-question-circle"></i> Câu hỏi</a>
                <a href="contacts.html"><i class="fas fa-envelope"></i> Liên hệ</a>
                <a href="../index.html"><i class="fas fa-home"></i> Về trang chủ</a>
            </nav>
        </aside>

        <main class="admin-main">
            <div class="admin-header">
                <h1>Quản lý Bài viết</h1>
                <div class="user-info">
                    <span id="adminName">Admin</span>
                    <a href="#" id="adminLogout" class="btn btn-outline btn-sm">Đăng xuất</a>
                </div>
            </div>

            <!-- Filter & Actions Bar -->
            <div class="admin-toolbar">
                <div class="toolbar-left">
                    <button class="btn btn-success" id="addArticleBtn">
                        <i class="fas fa-plus"></i> Thêm bài viết
                    </button>
                    <button class="btn btn-warning" id="exportBtn" title="Xuất dữ liệu ra file JSON">
                        <i class="fas fa-download"></i> Xuất JSON
                    </button>
                    <button class="btn btn-primary" id="syncBtn" title="Đồng bộ với file gốc">
                        <i class="fas fa-sync"></i> Đồng bộ
                    </button>
                </div>
                <div class="toolbar-right">
                    <select id="categoryFilter" class="filter-select">
                        <option value="">Tất cả danh mục</option>
                    </select>
                    <select id="featuredFilter" class="filter-select">
                        <option value="">Tất cả</option>
                        <option value="true">Nổi bật</option>
                        <option value="false">Không nổi bật</option>
                    </select>
                    <input type="text" id="searchInput" placeholder="Tìm kiếm bài viết..." class="search-input">
                </div>
            </div>

            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Tiêu đề</th>
                            <th>Danh mục</th>
                            <th>Tác giả</th>
                            <th>Lượt xem</th>
                            <th>Nổi bật</th>
                            <th>Ngày đăng</th>
                            <th>Hành động</th>
                        </tr>
                    </thead>
                    <tbody id="articlesTable">
                        <tr><td colspan="8" style="text-align: center;">Đang tải...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="pagination" id="pagination"></div>
        </main>
    </div>

    <!-- Add/Edit Article Modal -->
    <div class="modal" id="articleModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 id="modalTitle">Thêm bài viết mới</h2>
                <button class="modal-close" onclick="closeArticleModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="articleForm" class="admin-form">
                <input type="hidden" id="articleId">
                
                <div class="form-group">
                    <label for="articleTitle">Tiêu đề *</label>
                    <input type="text" id="articleTitle" required placeholder="Nhập tiêu đề bài viết">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="articleCategory">Danh mục *</label>
                        <select id="articleCategory" required>
                            <option value="">Chọn danh mục</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="articleAuthor">Tác giả *</label>
                        <input type="text" id="articleAuthor" required placeholder="Tên tác giả">
                    </div>
                </div>

                <div class="form-group">
                    <label for="articleExcerpt">Mô tả ngắn *</label>
                    <textarea id="articleExcerpt" required placeholder="Mô tả ngắn về bài viết" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label for="articleContent">Nội dung *</label>
                    <div class="editor-toolbar">
                        <button type="button" class="editor-btn" onclick="formatText('bold')" title="In đậm">
                            <i class="fas fa-bold"></i>
                        </button>
                        <button type="button" class="editor-btn" onclick="formatText('italic')" title="In nghiêng">
                            <i class="fas fa-italic"></i>
                        </button>
                        <button type="button" class="editor-btn" onclick="formatText('underline')" title="Gạch chân">
                            <i class="fas fa-underline"></i>
                        </button>
                        <span class="editor-divider"></span>
                        <button type="button" class="editor-btn" onclick="formatHeading('h2')" title="Tiêu đề lớn">
                            <i class="fas fa-heading"></i> H2
                        </button>
                        <button type="button" class="editor-btn" onclick="formatHeading('h3')" title="Tiêu đề nhỏ">
                            <i class="fas fa-heading"></i> H3
                        </button>
                        <span class="editor-divider"></span>
                        <button type="button" class="editor-btn" onclick="formatList('ul')" title="Danh sách">
                            <i class="fas fa-list-ul"></i>
                        </button>
                        <button type="button" class="editor-btn" onclick="formatList('ol')" title="Danh sách số">
                            <i class="fas fa-list-ol"></i>
                        </button>
                        <span class="editor-divider"></span>
                        <button type="button" class="editor-btn" onclick="insertLink()" title="Chèn link">
                            <i class="fas fa-link"></i>
                        </button>
                        <button type="button" class="editor-btn" onclick="insertImage()" title="Chèn hình">
                            <i class="fas fa-image"></i>
                        </button>
                        <span class="editor-divider"></span>
                        <button type="button" class="editor-btn" onclick="toggleEditorMode()" title="Chuyển chế độ" id="editorModeBtn">
                            <i class="fas fa-code"></i> HTML
                        </button>
                    </div>
                    <div id="articleContentEditor" class="content-editor" contenteditable="true" placeholder="Nhập nội dung bài viết..."></div>
                    <textarea id="articleContent" required style="display: none;"></textarea>
                    <small class="form-hint">Sử dụng các nút phía trên để định dạng văn bản. Nhấn "HTML" để xem/chỉnh sửa mã HTML.</small>
                </div>

                <div class="form-group">
                    <label>Hình ảnh bài viết</label>
                    <div class="image-upload-section">
                        <div class="upload-tabs">
                            <button type="button" class="upload-tab active" data-tab="file">
                                <i class="fas fa-upload"></i> Chọn file
                            </button>
                            <button type="button" class="upload-tab" data-tab="url">
                                <i class="fas fa-link"></i> Nhập URL
                            </button>
                        </div>
                        
                        <div class="upload-content">
                            <div class="upload-panel active" id="filePanel">
                                <input type="file" id="articleImageFile" accept="image/*" style="display: none;">
                                <button type="button" class="btn btn-outline btn-upload" onclick="document.getElementById('articleImageFile').click()">
                                    <i class="fas fa-cloud-upload-alt"></i> Chọn hình ảnh
                                </button>
                                <p class="upload-hint">Hỗ trợ: JPG, PNG, GIF (tối đa 5MB)</p>
                                <div id="imagePreview" class="image-preview"></div>
                            </div>
                            
                            <div class="upload-panel" id="urlPanel">
                                <input type="url" id="articleImageUrl" placeholder="https://example.com/image.jpg" class="form-control">
                                <button type="button" class="btn btn-outline btn-sm" onclick="previewImageUrl()">
                                    <i class="fas fa-eye"></i> Xem trước
                                </button>
                                <div id="urlImagePreview" class="image-preview"></div>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="articleImage">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="articleTags">Tags (phân cách bằng dấu phẩy)</label>
                        <input type="text" id="articleTags" placeholder="tag1, tag2, tag3">
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="articleFeatured">
                            <span>Đánh dấu nổi bật</span>
                        </label>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="closeArticleModal()">Hủy</button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Lưu bài viết
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="../js/auth.js"></script>
    <script src="../js/admin.js"></script>
    <script>
        let allArticles = [];
        let categories = [];
        let filteredArticles = [];
        let currentPage = 1;
        const itemsPerPage = 10;
        
        // Load data
        async function loadData() {
            try {
                const [articlesRes, categoriesRes] = await Promise.all([
                    fetch('../data/articles.json'),
                    fetch('../data/categories.json')
                ]);
                
                allArticles = await articlesRes.json();
                categories = await categoriesRes.json();
                
                // Load from localStorage if exists
                const localArticles = localStorage.getItem('articles');
                if (localArticles) {
                    allArticles = JSON.parse(localArticles);
                }
                
                filteredArticles = [...allArticles];
                
                // Populate category filters
                const categoryFilter = document.getElementById('categoryFilter');
                const articleCategory = document.getElementById('articleCategory');
                
                categories.forEach(cat => {
                    categoryFilter.innerHTML += `<option value="${cat.id}">${cat.name}</option>`;
                    articleCategory.innerHTML += `<option value="${cat.id}">${cat.name}</option>`;
                });
                
                renderArticles();
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }
        
        // Render articles table
        function renderArticles() {
            const tbody = document.getElementById('articlesTable');
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageArticles = filteredArticles.slice(start, end);
            
            if (pageArticles.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center;">Không có bài viết nào</td></tr>';
            } else {
                tbody.innerHTML = pageArticles.map(article => {
                    const category = categories.find(c => c.id === article.categoryId);
                    const categoryName = category ? category.name : 'Không xác định';
                    
                    return `
                        <tr>
                            <td>${article.id}</td>
                            <td style="max-width: 300px;">${article.title}</td>
                            <td>${categoryName}</td>
                            <td>${article.author}</td>
                            <td>${article.views || 0}</td>
                            <td>
                                <span class="badge ${article.featured ? 'badge-success' : 'badge-warning'}">
                                    ${article.featured ? 'Có' : 'Không'}
                                </span>
                            </td>
                            <td>${formatDate(article.publishedAt)}</td>
                            <td>
                                <div class="action-buttons">
                                    <a href="../article.html?id=${article.id}" class="btn btn-primary btn-sm" target="_blank" title="Xem">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <button class="btn btn-warning btn-sm" onclick="editArticle(${article.id})" title="Sửa">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteArticle(${article.id})" title="Xóa">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');
            }
            
            renderPagination();
        }
        
        // Render pagination
        function renderPagination() {
            const totalPages = Math.ceil(filteredArticles.length / itemsPerPage);
            const pagination = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            let html = `
                <button ${currentPage === 1 ? 'disabled' : ''} onclick="changePage(${currentPage - 1})">
                    <i class="fas fa-chevron-left"></i>
                </button>
            `;
            
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
                    html += `<button class="${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
                } else if (i === currentPage - 2 || i === currentPage + 2) {
                    html += '<span>...</span>';
                }
            }
            
            html += `
                <button ${currentPage === totalPages ? 'disabled' : ''} onclick="changePage(${currentPage + 1})">
                    <i class="fas fa-chevron-right"></i>
                </button>
            `;
            
            pagination.innerHTML = html;
        }
        
        // Change page
        function changePage(page) {
            currentPage = page;
            renderArticles();
        }
        
        // Filter articles
        function filterArticles() {
            const categoryFilter = document.getElementById('categoryFilter').value;
            const featuredFilter = document.getElementById('featuredFilter').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            filteredArticles = allArticles.filter(article => {
                const matchCategory = !categoryFilter || article.categoryId === parseInt(categoryFilter);
                const matchFeatured = !featuredFilter || article.featured === (featuredFilter === 'true');
                const matchSearch = !searchTerm || 
                    article.title.toLowerCase().includes(searchTerm) ||
                    article.excerpt.toLowerCase().includes(searchTerm);
                
                return matchCategory && matchFeatured && matchSearch;
            });
            
            currentPage = 1;
            renderArticles();
        }
        
        // Open add article modal
        function openAddArticleModal() {
            document.getElementById('modalTitle').textContent = 'Thêm bài viết mới';
            document.getElementById('articleForm').reset();
            document.getElementById('articleId').value = '';
            
            // Reset editor
            const editor = document.getElementById('articleContentEditor');
            const textarea = document.getElementById('articleContent');
            if (editor && textarea) {
                editor.innerHTML = '';
                textarea.value = '';
                editorMode = 'visual';
                editor.style.display = 'block';
                textarea.style.display = 'none';
                document.getElementById('editorModeBtn').innerHTML = '<i class="fas fa-code"></i> HTML';
            }
            
            document.getElementById('articleModal').classList.add('active');
        }
        
        // Edit article
        function editArticle(id) {
            const article = allArticles.find(a => a.id === id);
            if (!article) return;
            
            document.getElementById('modalTitle').textContent = 'Chỉnh sửa bài viết';
            document.getElementById('articleId').value = article.id;
            document.getElementById('articleTitle').value = article.title;
            document.getElementById('articleCategory').value = article.categoryId;
            document.getElementById('articleAuthor').value = article.author;
            document.getElementById('articleExcerpt').value = article.excerpt;
            
            // Load content into editor
            const editor = document.getElementById('articleContentEditor');
            const textarea = document.getElementById('articleContent');
            if (editor && textarea) {
                editor.innerHTML = article.content || '';
                textarea.value = article.content || '';
                editorMode = 'visual';
                editor.style.display = 'block';
                textarea.style.display = 'none';
                document.getElementById('editorModeBtn').innerHTML = '<i class="fas fa-code"></i> HTML';
            }
            
            document.getElementById('articleImage').value = article.image || '';
            document.getElementById('articleTags').value = article.tags ? article.tags.join(', ') : '';
            document.getElementById('articleFeatured').checked = article.featured || false;
            
            // Show existing image
            if (article.image) {
                if (article.image.startsWith('data:')) {
                    // Base64 image
                    document.getElementById('imagePreview').innerHTML = `
                        <img src="${article.image}" alt="Preview">
                        <button type="button" class="btn-remove-image" onclick="removeImage()">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                } else {
                    // URL image
                    document.getElementById('articleImageUrl').value = article.image;
                    document.getElementById('urlImagePreview').innerHTML = `
                        <img src="${article.image}" alt="Preview">
                        <button type="button" class="btn-remove-image" onclick="removeUrlImage()">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    // Switch to URL tab
                    document.querySelectorAll('.upload-tab').forEach(t => t.classList.remove('active'));
                    document.querySelector('.upload-tab[data-tab="url"]').classList.add('active');
                    document.querySelectorAll('.upload-panel').forEach(p => p.classList.remove('active'));
                    document.getElementById('urlPanel').classList.add('active');
                }
            }
            
            document.getElementById('articleModal').classList.add('active');
        }
        
        // Delete article
        function deleteArticle(id) {
            if (!confirm('Bạn có chắc muốn xóa bài viết này?')) return;
            
            allArticles = allArticles.filter(a => a.id !== id);
            localStorage.setItem('articles', JSON.stringify(allArticles));
            filterArticles();
            alert('Đã xóa bài viết');
        }
        
        // Close modal
        function closeArticleModal() {
            document.getElementById('articleModal').classList.remove('active');
            document.getElementById('articleForm').reset();
            document.getElementById('imagePreview').innerHTML = '';
            document.getElementById('urlImagePreview').innerHTML = '';
            document.getElementById('articleImageUrl').value = '';
            
            // Reset to file tab
            document.querySelectorAll('.upload-tab').forEach(t => t.classList.remove('active'));
            document.querySelector('.upload-tab[data-tab="file"]').classList.add('active');
            document.querySelectorAll('.upload-panel').forEach(p => p.classList.remove('active'));
            document.getElementById('filePanel').classList.add('active');
        }
        
        // Save article
        document.getElementById('articleForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const id = document.getElementById('articleId').value;
            const articleData = {
                id: id ? parseInt(id) : Date.now(),
                title: document.getElementById('articleTitle').value,
                categoryId: parseInt(document.getElementById('articleCategory').value),
                author: document.getElementById('articleAuthor').value,
                excerpt: document.getElementById('articleExcerpt').value,
                content: document.getElementById('articleContent').value,
                image: document.getElementById('articleImage').value || 'https://via.placeholder.com/800x400',
                tags: document.getElementById('articleTags').value.split(',').map(t => t.trim()).filter(t => t),
                featured: document.getElementById('articleFeatured').checked,
                views: 0,
                publishedAt: new Date().toISOString()
            };
            
            if (id) {
                // Update existing
                const index = allArticles.findIndex(a => a.id === parseInt(id));
                if (index !== -1) {
                    allArticles[index] = { ...allArticles[index], ...articleData };
                }
            } else {
                // Add new
                allArticles.unshift(articleData);
            }
            
            localStorage.setItem('articles', JSON.stringify(allArticles));
            closeArticleModal();
            filterArticles();
            alert(id ? 'Đã cập nhật bài viết' : 'Đã thêm bài viết mới');
        });
        
        // Image upload handling
        function setupImageUpload() {
            // Tab switching
            document.querySelectorAll('.upload-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabType = this.dataset.tab;
                    
                    // Update active tab
                    document.querySelectorAll('.upload-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update active panel
                    document.querySelectorAll('.upload-panel').forEach(p => p.classList.remove('active'));
                    document.getElementById(tabType + 'Panel').classList.add('active');
                });
            });
            
            // File upload
            document.getElementById('articleImageFile').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                // Validate file size (5MB)
                if (file.size > 5 * 1024 * 1024) {
                    alert('File quá lớn! Vui lòng chọn file nhỏ hơn 5MB');
                    return;
                }
                
                // Validate file type
                if (!file.type.startsWith('image/')) {
                    alert('Vui lòng chọn file hình ảnh!');
                    return;
                }
                
                // Read and preview
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageData = e.target.result;
                    document.getElementById('articleImage').value = imageData;
                    
                    const preview = document.getElementById('imagePreview');
                    preview.innerHTML = `
                        <img src="${imageData}" alt="Preview">
                        <button type="button" class="btn-remove-image" onclick="removeImage()">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                };
                reader.readAsDataURL(file);
            });
        }
        
        // Preview image from URL
        function previewImageUrl() {
            const url = document.getElementById('articleImageUrl').value;
            if (!url) {
                alert('Vui lòng nhập URL hình ảnh');
                return;
            }
            
            document.getElementById('articleImage').value = url;
            
            const preview = document.getElementById('urlImagePreview');
            preview.innerHTML = `
                <img src="${url}" alt="Preview" onerror="this.parentElement.innerHTML='<p style=color:red>Không thể tải hình ảnh từ URL này</p>'">
                <button type="button" class="btn-remove-image" onclick="removeUrlImage()">
                    <i class="fas fa-times"></i>
                </button>
            `;
        }
        
        // Remove image
        function removeImage() {
            document.getElementById('articleImageFile').value = '';
            document.getElementById('articleImage').value = '';
            document.getElementById('imagePreview').innerHTML = '';
        }
        
        function removeUrlImage() {
            document.getElementById('articleImageUrl').value = '';
            document.getElementById('articleImage').value = '';
            document.getElementById('urlImagePreview').innerHTML = '';
        }
        
        // Export to JSON
        function exportToJSON() {
            const dataStr = JSON.stringify(allArticles, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'articles.json';
            link.click();
            URL.revokeObjectURL(url);
            alert('Đã xuất file articles.json! Hãy copy nội dung vào thư mục data/');
        }
        
        // Sync with original JSON
        function syncWithOriginal() {
            if (confirm('Đồng bộ sẽ xóa tất cả thay đổi trong localStorage và load lại từ file JSON gốc. Bạn có chắc?')) {
                localStorage.removeItem('articles');
                location.reload();
            }
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setupImageUpload();
            
            document.getElementById('addArticleBtn').addEventListener('click', openAddArticleModal);
            document.getElementById('exportBtn').addEventListener('click', exportToJSON);
            document.getElementById('syncBtn').addEventListener('click', syncWithOriginal);
            document.getElementById('categoryFilter').addEventListener('change', filterArticles);
            document.getElementById('featuredFilter').addEventListener('change', filterArticles);
            document.getElementById('searchInput').addEventListener('input', filterArticles);
            
            // Setup editor auto-sync
            const editor = document.getElementById('articleContentEditor');
            if (editor) {
                editor.addEventListener('input', syncEditorContent);
                editor.addEventListener('blur', syncEditorContent);
            }
        });
        
        // ===== RICH TEXT EDITOR FUNCTIONS =====
        
        let editorMode = 'visual'; // 'visual' or 'html'
        
        // Sync editor content with textarea
        function syncEditorContent() {
            const editor = document.getElementById('articleContentEditor');
            const textarea = document.getElementById('articleContent');
            if (editorMode === 'visual') {
                textarea.value = editor.innerHTML;
            } else {
                editor.innerHTML = textarea.value;
            }
        }
        
        // Format text (bold, italic, underline)
        function formatText(command) {
            document.execCommand(command, false, null);
            document.getElementById('articleContentEditor').focus();
            syncEditorContent();
        }
        
        // Format heading
        function formatHeading(tag) {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                const selectedText = range.toString();
                
                if (selectedText) {
                    const heading = document.createElement(tag);
                    heading.textContent = selectedText;
                    range.deleteContents();
                    range.insertNode(heading);
                    
                    // Add line break after heading
                    const br = document.createElement('br');
                    heading.parentNode.insertBefore(br, heading.nextSibling);
                }
            }
            syncEditorContent();
        }
        
        // Format list
        function formatList(type) {
            if (type === 'ul') {
                document.execCommand('insertUnorderedList', false, null);
            } else {
                document.execCommand('insertOrderedList', false, null);
            }
            document.getElementById('articleContentEditor').focus();
            syncEditorContent();
        }
        
        // Insert link
        function insertLink() {
            const url = prompt('Nhập URL:');
            if (url) {
                const text = window.getSelection().toString() || url;
                document.execCommand('createLink', false, url);
                syncEditorContent();
            }
        }
        
        // Insert image
        function insertImage() {
            const url = prompt('Nhập URL hình ảnh:');
            if (url) {
                document.execCommand('insertImage', false, url);
                syncEditorContent();
            }
        }
        
        // Toggle between visual and HTML mode
        function toggleEditorMode() {
            const editor = document.getElementById('articleContentEditor');
            const textarea = document.getElementById('articleContent');
            const modeBtn = document.getElementById('editorModeBtn');
            
            if (editorMode === 'visual') {
                // Switch to HTML mode
                textarea.value = editor.innerHTML;
                editor.style.display = 'none';
                textarea.style.display = 'block';
                textarea.style.height = '400px';
                textarea.style.fontFamily = 'monospace';
                modeBtn.innerHTML = '<i class="fas fa-eye"></i> Xem trước';
                editorMode = 'html';
            } else {
                // Switch to visual mode
                editor.innerHTML = textarea.value;
                editor.style.display = 'block';
                textarea.style.display = 'none';
                modeBtn.innerHTML = '<i class="fas fa-code"></i> HTML';
                editorMode = 'visual';
            }
        }
    </script>
    
    <style>
        /* Rich Text Editor Styles */
        .editor-toolbar {
            display: flex;
            gap: 4px;
            padding: 8px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            flex-wrap: wrap;
        }
        
        .editor-btn {
            padding: 6px 10px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .editor-btn:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }
        
        .editor-btn:active {
            background: #dee2e6;
        }
        
        .editor-divider {
            width: 1px;
            background: #ddd;
            margin: 0 4px;
        }
        
        .content-editor {
            min-height: 400px;
            padding: 16px;
            border: 1px solid #ddd;
            border-radius: 0 0 8px 8px;
            background: white;
            font-size: 16px;
            line-height: 1.6;
            overflow-y: auto;
            max-height: 600px;
        }
        
        .content-editor:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .content-editor[placeholder]:empty:before {
            content: attr(placeholder);
            color: #999;
        }
        
        .content-editor h2 {
            font-size: 1.8em;
            margin: 20px 0 10px 0;
            color: #333;
        }
        
        .content-editor h3 {
            font-size: 1.4em;
            margin: 16px 0 8px 0;
            color: #444;
        }
        
        .content-editor p {
            margin: 12px 0;
        }
        
        .content-editor ul, .content-editor ol {
            margin: 12px 0;
            padding-left: 30px;
        }
        
        .content-editor li {
            margin: 6px 0;
        }
        
        .content-editor a {
            color: var(--primary-color);
            text-decoration: underline;
        }
        
        .content-editor img {
            max-width: 100%;
            height: auto;
            margin: 12px 0;
            border-radius: 8px;
        }
        
        .form-hint {
            display: block;
            margin-top: 8px;
            color: #666;
            font-size: 13px;
        }
    </style>
</body>
</html>
